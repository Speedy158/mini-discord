{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\ericb\\\\mini-discord\\\\frontend\\\\src\\\\components\\\\VoicePanel.jsx\",\n  _s = $RefreshSig$();\n// src/components/VoicePanel.jsx\nimport React, { useEffect, useState } from \"react\";\nimport socket from \"../socket\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst API_BASE = \"http://localhost:3000\";\nfunction VoicePanel({\n  username\n}) {\n  _s();\n  const [channels, setChannels] = useState([]);\n  const [currentVoiceChannel, setCurrentVoiceChannel] = useState(null);\n  const [voiceState, setVoiceState] = useState({});\n  const [speakingUsers, setSpeakingUsers] = useState([]);\n  const sessionId = localStorage.getItem(\"sessionId\");\n  async function loadChannels() {\n    if (!sessionId) return;\n    try {\n      const res = await fetch(`${API_BASE}/api/channels/list`, {\n        headers: {\n          \"x-session-id\": sessionId\n        }\n      });\n      const data = await res.json();\n      if (data.ok) {\n        setChannels(data.channels);\n      } else {\n        console.warn(\"VoicePanel: Channels konnten nicht geladen werden:\", data.error);\n      }\n    } catch (err) {\n      console.error(\"Fehler beim Laden der Channels (Voice):\", err);\n    }\n  }\n  useEffect(() => {\n    loadChannels();\n  }, []);\n  useEffect(() => {\n    if (username) {\n      socket.emit(\"registerUser\", {\n        username\n      });\n    }\n    function handleVoiceUpdate(state) {\n      setVoiceState(state || {});\n    }\n    function handleSpeakingStart({\n      user\n    }) {\n      setSpeakingUsers(prev => prev.includes(user) ? prev : [...prev, user]);\n    }\n    function handleSpeakingStop({\n      user\n    }) {\n      setSpeakingUsers(prev => prev.filter(u => u !== user));\n    }\n    socket.on(\"voiceChannelUpdate\", handleVoiceUpdate);\n    socket.on(\"speakingStart\", handleSpeakingStart);\n    socket.on(\"speakingStop\", handleSpeakingStop);\n    return () => {\n      socket.off(\"voiceChannelUpdate\", handleVoiceUpdate);\n      socket.off(\"speakingStart\", handleSpeakingStart);\n      socket.off(\"speakingStop\", handleSpeakingStop);\n    };\n  }, [username]);\n  function joinChannel(channel) {\n    if (!username) {\n      alert(\"Kein Username gesetzt.\");\n      return;\n    }\n    socket.emit(\"joinVoiceChannel\", {\n      channel\n    });\n    setCurrentVoiceChannel(channel);\n  }\n  function leaveChannel() {\n    if (!currentVoiceChannel) return;\n    socket.emit(\"leaveVoiceChannel\", {\n      channel: currentVoiceChannel\n    });\n    setCurrentVoiceChannel(null);\n  }\n  function startSpeaking() {\n    if (!currentVoiceChannel) return;\n    socket.emit(\"speakingStart\", {\n      channel: currentVoiceChannel\n    });\n  }\n  function stopSpeaking() {\n    if (!currentVoiceChannel) return;\n    socket.emit(\"speakingStop\", {\n      channel: currentVoiceChannel\n    });\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"voice-panel\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"voice-header\",\n      children: \"Voice-Channels\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"voice-channels\",\n      children: channels.map(ch => {\n        const users = voiceState[ch] || [];\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"voice-channel\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"voice-channel-header\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              children: ch\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 106,\n              columnNumber: 17\n            }, this), currentVoiceChannel === ch ? /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: leaveChannel,\n              children: \"Leave\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 108,\n              columnNumber: 19\n            }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => joinChannel(ch),\n              children: \"Join\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 110,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 105,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"voice-channel-users\",\n            children: users.map(u => /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"voice-user\" + (speakingUsers.includes(u.username) ? \" voice-user-speaking\" : \"\"),\n              children: u.username\n            }, u.id, false, {\n              fileName: _jsxFileName,\n              lineNumber: 115,\n              columnNumber: 19\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 113,\n            columnNumber: 15\n          }, this)]\n        }, ch, true, {\n          fileName: _jsxFileName,\n          lineNumber: 104,\n          columnNumber: 13\n        }, this);\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 7\n    }, this), currentVoiceChannel && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"voice-controls\",\n      children: /*#__PURE__*/_jsxDEV(\"button\", {\n        onMouseDown: startSpeaking,\n        onMouseUp: stopSpeaking,\n        children: \"Push-to-Talk\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 132,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 97,\n    columnNumber: 5\n  }, this);\n}\n_s(VoicePanel, \"cERGnKX8yHf/7oH0z8jWSrZmHcM=\");\n_c = VoicePanel;\nexport default VoicePanel;\nvar _c;\n$RefreshReg$(_c, \"VoicePanel\");","map":{"version":3,"names":["React","useEffect","useState","socket","jsxDEV","_jsxDEV","API_BASE","VoicePanel","username","_s","channels","setChannels","currentVoiceChannel","setCurrentVoiceChannel","voiceState","setVoiceState","speakingUsers","setSpeakingUsers","sessionId","localStorage","getItem","loadChannels","res","fetch","headers","data","json","ok","console","warn","error","err","emit","handleVoiceUpdate","state","handleSpeakingStart","user","prev","includes","handleSpeakingStop","filter","u","on","off","joinChannel","channel","alert","leaveChannel","startSpeaking","stopSpeaking","className","children","fileName","_jsxFileName","lineNumber","columnNumber","map","ch","users","onClick","id","onMouseDown","onMouseUp","_c","$RefreshReg$"],"sources":["C:/Users/ericb/mini-discord/frontend/src/components/VoicePanel.jsx"],"sourcesContent":["// src/components/VoicePanel.jsx\r\nimport React, { useEffect, useState } from \"react\";\r\nimport socket from \"../socket\";\r\n\r\nconst API_BASE = \"http://localhost:3000\";\r\n\r\nfunction VoicePanel({ username }) {\r\n  const [channels, setChannels] = useState([]);\r\n  const [currentVoiceChannel, setCurrentVoiceChannel] = useState(null);\r\n  const [voiceState, setVoiceState] = useState({});\r\n  const [speakingUsers, setSpeakingUsers] = useState([]);\r\n\r\n  const sessionId = localStorage.getItem(\"sessionId\");\r\n\r\n  async function loadChannels() {\r\n    if (!sessionId) return;\r\n\r\n    try {\r\n      const res = await fetch(`${API_BASE}/api/channels/list`, {\r\n        headers: {\r\n          \"x-session-id\": sessionId\r\n        }\r\n      });\r\n\r\n      const data = await res.json();\r\n\r\n      if (data.ok) {\r\n        setChannels(data.channels);\r\n      } else {\r\n        console.warn(\"VoicePanel: Channels konnten nicht geladen werden:\", data.error);\r\n      }\r\n    } catch (err) {\r\n      console.error(\"Fehler beim Laden der Channels (Voice):\", err);\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    loadChannels();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (username) {\r\n      socket.emit(\"registerUser\", { username });\r\n    }\r\n\r\n    function handleVoiceUpdate(state) {\r\n      setVoiceState(state || {});\r\n    }\r\n\r\n    function handleSpeakingStart({ user }) {\r\n      setSpeakingUsers((prev) =>\r\n        prev.includes(user) ? prev : [...prev, user]\r\n      );\r\n    }\r\n\r\n    function handleSpeakingStop({ user }) {\r\n      setSpeakingUsers((prev) => prev.filter((u) => u !== user));\r\n    }\r\n\r\n    socket.on(\"voiceChannelUpdate\", handleVoiceUpdate);\r\n    socket.on(\"speakingStart\", handleSpeakingStart);\r\n    socket.on(\"speakingStop\", handleSpeakingStop);\r\n\r\n    return () => {\r\n      socket.off(\"voiceChannelUpdate\", handleVoiceUpdate);\r\n      socket.off(\"speakingStart\", handleSpeakingStart);\r\n      socket.off(\"speakingStop\", handleSpeakingStop);\r\n    };\r\n  }, [username]);\r\n\r\n  function joinChannel(channel) {\r\n    if (!username) {\r\n      alert(\"Kein Username gesetzt.\");\r\n      return;\r\n    }\r\n    socket.emit(\"joinVoiceChannel\", { channel });\r\n    setCurrentVoiceChannel(channel);\r\n  }\r\n\r\n  function leaveChannel() {\r\n    if (!currentVoiceChannel) return;\r\n    socket.emit(\"leaveVoiceChannel\", { channel: currentVoiceChannel });\r\n    setCurrentVoiceChannel(null);\r\n  }\r\n\r\n  function startSpeaking() {\r\n    if (!currentVoiceChannel) return;\r\n    socket.emit(\"speakingStart\", { channel: currentVoiceChannel });\r\n  }\r\n\r\n  function stopSpeaking() {\r\n    if (!currentVoiceChannel) return;\r\n    socket.emit(\"speakingStop\", { channel: currentVoiceChannel });\r\n  }\r\n\r\n  return (\r\n    <div className=\"voice-panel\">\r\n      <div className=\"voice-header\">Voice-Channels</div>\r\n\r\n      <div className=\"voice-channels\">\r\n        {channels.map((ch) => {\r\n          const users = voiceState[ch] || [];\r\n          return (\r\n            <div key={ch} className=\"voice-channel\">\r\n              <div className=\"voice-channel-header\">\r\n                <span>{ch}</span>\r\n                {currentVoiceChannel === ch ? (\r\n                  <button onClick={leaveChannel}>Leave</button>\r\n                ) : (\r\n                  <button onClick={() => joinChannel(ch)}>Join</button>\r\n                )}\r\n              </div>\r\n              <div className=\"voice-channel-users\">\r\n                {users.map((u) => (\r\n                  <div\r\n                    key={u.id}\r\n                    className={\r\n                      \"voice-user\" +\r\n                      (speakingUsers.includes(u.username) ? \" voice-user-speaking\" : \"\")\r\n                    }\r\n                  >\r\n                    {u.username}\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n\r\n      {currentVoiceChannel && (\r\n        <div className=\"voice-controls\">\r\n          <button onMouseDown={startSpeaking} onMouseUp={stopSpeaking}>\r\n            Push-to-Talk\r\n          </button>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default VoicePanel;\r\n"],"mappings":";;AAAA;AACA,OAAOA,KAAK,IAAIC,SAAS,EAAEC,QAAQ,QAAQ,OAAO;AAClD,OAAOC,MAAM,MAAM,WAAW;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAE/B,MAAMC,QAAQ,GAAG,uBAAuB;AAExC,SAASC,UAAUA,CAAC;EAAEC;AAAS,CAAC,EAAE;EAAAC,EAAA;EAChC,MAAM,CAACC,QAAQ,EAAEC,WAAW,CAAC,GAAGT,QAAQ,CAAC,EAAE,CAAC;EAC5C,MAAM,CAACU,mBAAmB,EAAEC,sBAAsB,CAAC,GAAGX,QAAQ,CAAC,IAAI,CAAC;EACpE,MAAM,CAACY,UAAU,EAAEC,aAAa,CAAC,GAAGb,QAAQ,CAAC,CAAC,CAAC,CAAC;EAChD,MAAM,CAACc,aAAa,EAAEC,gBAAgB,CAAC,GAAGf,QAAQ,CAAC,EAAE,CAAC;EAEtD,MAAMgB,SAAS,GAAGC,YAAY,CAACC,OAAO,CAAC,WAAW,CAAC;EAEnD,eAAeC,YAAYA,CAAA,EAAG;IAC5B,IAAI,CAACH,SAAS,EAAE;IAEhB,IAAI;MACF,MAAMI,GAAG,GAAG,MAAMC,KAAK,CAAC,GAAGjB,QAAQ,oBAAoB,EAAE;QACvDkB,OAAO,EAAE;UACP,cAAc,EAAEN;QAClB;MACF,CAAC,CAAC;MAEF,MAAMO,IAAI,GAAG,MAAMH,GAAG,CAACI,IAAI,CAAC,CAAC;MAE7B,IAAID,IAAI,CAACE,EAAE,EAAE;QACXhB,WAAW,CAACc,IAAI,CAACf,QAAQ,CAAC;MAC5B,CAAC,MAAM;QACLkB,OAAO,CAACC,IAAI,CAAC,oDAAoD,EAAEJ,IAAI,CAACK,KAAK,CAAC;MAChF;IACF,CAAC,CAAC,OAAOC,GAAG,EAAE;MACZH,OAAO,CAACE,KAAK,CAAC,yCAAyC,EAAEC,GAAG,CAAC;IAC/D;EACF;EAEA9B,SAAS,CAAC,MAAM;IACdoB,YAAY,CAAC,CAAC;EAChB,CAAC,EAAE,EAAE,CAAC;EAENpB,SAAS,CAAC,MAAM;IACd,IAAIO,QAAQ,EAAE;MACZL,MAAM,CAAC6B,IAAI,CAAC,cAAc,EAAE;QAAExB;MAAS,CAAC,CAAC;IAC3C;IAEA,SAASyB,iBAAiBA,CAACC,KAAK,EAAE;MAChCnB,aAAa,CAACmB,KAAK,IAAI,CAAC,CAAC,CAAC;IAC5B;IAEA,SAASC,mBAAmBA,CAAC;MAAEC;IAAK,CAAC,EAAE;MACrCnB,gBAAgB,CAAEoB,IAAI,IACpBA,IAAI,CAACC,QAAQ,CAACF,IAAI,CAAC,GAAGC,IAAI,GAAG,CAAC,GAAGA,IAAI,EAAED,IAAI,CAC7C,CAAC;IACH;IAEA,SAASG,kBAAkBA,CAAC;MAAEH;IAAK,CAAC,EAAE;MACpCnB,gBAAgB,CAAEoB,IAAI,IAAKA,IAAI,CAACG,MAAM,CAAEC,CAAC,IAAKA,CAAC,KAAKL,IAAI,CAAC,CAAC;IAC5D;IAEAjC,MAAM,CAACuC,EAAE,CAAC,oBAAoB,EAAET,iBAAiB,CAAC;IAClD9B,MAAM,CAACuC,EAAE,CAAC,eAAe,EAAEP,mBAAmB,CAAC;IAC/ChC,MAAM,CAACuC,EAAE,CAAC,cAAc,EAAEH,kBAAkB,CAAC;IAE7C,OAAO,MAAM;MACXpC,MAAM,CAACwC,GAAG,CAAC,oBAAoB,EAAEV,iBAAiB,CAAC;MACnD9B,MAAM,CAACwC,GAAG,CAAC,eAAe,EAAER,mBAAmB,CAAC;MAChDhC,MAAM,CAACwC,GAAG,CAAC,cAAc,EAAEJ,kBAAkB,CAAC;IAChD,CAAC;EACH,CAAC,EAAE,CAAC/B,QAAQ,CAAC,CAAC;EAEd,SAASoC,WAAWA,CAACC,OAAO,EAAE;IAC5B,IAAI,CAACrC,QAAQ,EAAE;MACbsC,KAAK,CAAC,wBAAwB,CAAC;MAC/B;IACF;IACA3C,MAAM,CAAC6B,IAAI,CAAC,kBAAkB,EAAE;MAAEa;IAAQ,CAAC,CAAC;IAC5ChC,sBAAsB,CAACgC,OAAO,CAAC;EACjC;EAEA,SAASE,YAAYA,CAAA,EAAG;IACtB,IAAI,CAACnC,mBAAmB,EAAE;IAC1BT,MAAM,CAAC6B,IAAI,CAAC,mBAAmB,EAAE;MAAEa,OAAO,EAAEjC;IAAoB,CAAC,CAAC;IAClEC,sBAAsB,CAAC,IAAI,CAAC;EAC9B;EAEA,SAASmC,aAAaA,CAAA,EAAG;IACvB,IAAI,CAACpC,mBAAmB,EAAE;IAC1BT,MAAM,CAAC6B,IAAI,CAAC,eAAe,EAAE;MAAEa,OAAO,EAAEjC;IAAoB,CAAC,CAAC;EAChE;EAEA,SAASqC,YAAYA,CAAA,EAAG;IACtB,IAAI,CAACrC,mBAAmB,EAAE;IAC1BT,MAAM,CAAC6B,IAAI,CAAC,cAAc,EAAE;MAAEa,OAAO,EAAEjC;IAAoB,CAAC,CAAC;EAC/D;EAEA,oBACEP,OAAA;IAAK6C,SAAS,EAAC,aAAa;IAAAC,QAAA,gBAC1B9C,OAAA;MAAK6C,SAAS,EAAC,cAAc;MAAAC,QAAA,EAAC;IAAc;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAK,CAAC,eAElDlD,OAAA;MAAK6C,SAAS,EAAC,gBAAgB;MAAAC,QAAA,EAC5BzC,QAAQ,CAAC8C,GAAG,CAAEC,EAAE,IAAK;QACpB,MAAMC,KAAK,GAAG5C,UAAU,CAAC2C,EAAE,CAAC,IAAI,EAAE;QAClC,oBACEpD,OAAA;UAAc6C,SAAS,EAAC,eAAe;UAAAC,QAAA,gBACrC9C,OAAA;YAAK6C,SAAS,EAAC,sBAAsB;YAAAC,QAAA,gBACnC9C,OAAA;cAAA8C,QAAA,EAAOM;YAAE;cAAAL,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAO,CAAC,EAChB3C,mBAAmB,KAAK6C,EAAE,gBACzBpD,OAAA;cAAQsD,OAAO,EAAEZ,YAAa;cAAAI,QAAA,EAAC;YAAK;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAQ,CAAC,gBAE7ClD,OAAA;cAAQsD,OAAO,EAAEA,CAAA,KAAMf,WAAW,CAACa,EAAE,CAAE;cAAAN,QAAA,EAAC;YAAI;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAQ,CACrD;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACE,CAAC,eACNlD,OAAA;YAAK6C,SAAS,EAAC,qBAAqB;YAAAC,QAAA,EACjCO,KAAK,CAACF,GAAG,CAAEf,CAAC,iBACXpC,OAAA;cAEE6C,SAAS,EACP,YAAY,IACXlC,aAAa,CAACsB,QAAQ,CAACG,CAAC,CAACjC,QAAQ,CAAC,GAAG,sBAAsB,GAAG,EAAE,CAClE;cAAA2C,QAAA,EAEAV,CAAC,CAACjC;YAAQ,GANNiC,CAAC,CAACmB,EAAE;cAAAR,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAON,CACN;UAAC;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACC,CAAC;QAAA,GArBEE,EAAE;UAAAL,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAsBP,CAAC;MAEV,CAAC;IAAC;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACC,CAAC,EAEL3C,mBAAmB,iBAClBP,OAAA;MAAK6C,SAAS,EAAC,gBAAgB;MAAAC,QAAA,eAC7B9C,OAAA;QAAQwD,WAAW,EAAEb,aAAc;QAACc,SAAS,EAAEb,YAAa;QAAAE,QAAA,EAAC;MAE7D;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAQ;IAAC;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACN,CACN;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACE,CAAC;AAEV;AAAC9C,EAAA,CArIQF,UAAU;AAAAwD,EAAA,GAAVxD,UAAU;AAuInB,eAAeA,UAAU;AAAC,IAAAwD,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
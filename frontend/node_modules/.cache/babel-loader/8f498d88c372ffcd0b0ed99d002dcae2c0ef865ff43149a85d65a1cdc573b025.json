{"ast":null,"code":"import React,{useEffect,useState,useRef}from\"react\";import{socket}from\"../socket\";import{jsxs as _jsxs,jsx as _jsx}from\"react/jsx-runtime\";export default function ChatWindow(_ref){let{channel}=_ref;const[messages,setMessages]=useState([]);const[contextMenu,setContextMenu]=useState(null);const username=localStorage.getItem(\"username\");const scrollRef=useRef(null);useEffect(()=>{socket.emit(\"requestMessages\",{channel});},[channel]);useEffect(()=>{const load=msgs=>setMessages(msgs);const add=msg=>{if(msg.channel===channel){setMessages(prev=>[...prev,msg]);}};const edit=_ref2=>{let{index,newText}=_ref2;setMessages(prev=>{const copy=[...prev];if(copy[index])copy[index].text=newText;return copy;});};const del=_ref3=>{let{index}=_ref3;setMessages(prev=>prev.filter((_,i)=>i!==index));};socket.on(\"loadMessages\",load);socket.on(\"newMessage\",add);socket.on(\"messageEdited\",edit);socket.on(\"messageDeleted\",del);return()=>{socket.off(\"loadMessages\",load);socket.off(\"newMessage\",add);socket.off(\"messageEdited\",edit);socket.off(\"messageDeleted\",del);};},[channel]);useEffect(()=>{if(scrollRef.current){scrollRef.current.scrollTop=scrollRef.current.scrollHeight;}},[messages]);const sendMessage=()=>{const input=document.getElementById(\"chatInput\");const text=input.value.trim();if(!text)return;socket.emit(\"sendMessage\",{channel,user:username,text});input.value=\"\";};const handleKey=e=>{if(e.key===\"Enter\")sendMessage();};const openContextMenu=(e,index)=>{e.preventDefault();setContextMenu({x:e.clientX,y:e.clientY,index});};const closeContextMenu=()=>setContextMenu(null);const editMessage=index=>{const newText=prompt(\"Neue Nachricht:\");if(!newText)return;socket.emit(\"editMessage\",{channel,index,newText});};const deleteMessage=index=>{if(!window.confirm(\"Nachricht löschen?\"))return;socket.emit(\"deleteMessage\",{channel,index});};return/*#__PURE__*/_jsxs(\"div\",{style:{flex:1,display:\"flex\",flexDirection:\"column\"},children:[/*#__PURE__*/_jsxs(\"div\",{ref:scrollRef,style:{flex:1,overflowY:\"auto\",padding:20,color:\"white\"},children:[/*#__PURE__*/_jsxs(\"h3\",{children:[\"# \",channel]}),messages.map((m,i)=>/*#__PURE__*/_jsxs(\"div\",{onContextMenu:e=>openContextMenu(e,i),style:{marginBottom:10,cursor:\"context-menu\"},children:[/*#__PURE__*/_jsxs(\"b\",{children:[m.user,\":\"]}),\" \",m.text]},i))]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\",padding:10,background:\"#232428\",borderTop:\"1px solid #3a3b3f\"},children:[/*#__PURE__*/_jsx(\"input\",{id:\"chatInput\",onKeyDown:handleKey,placeholder:\"Nachricht in #\".concat(channel,\"...\"),style:{flex:1,padding:10,borderRadius:4,border:\"none\",outline:\"none\"}}),/*#__PURE__*/_jsx(\"button\",{onClick:sendMessage,style:{marginLeft:10,padding:\"10px 20px\",background:\"#5865F2\",border:\"none\",borderRadius:4,color:\"white\",cursor:\"pointer\"},children:\"Senden\"})]}),contextMenu&&/*#__PURE__*/_jsxs(\"div\",{style:{position:\"fixed\",top:contextMenu.y,left:contextMenu.x,background:\"#2b2d31\",padding:10,borderRadius:4,zIndex:999,boxShadow:\"0 0 10px rgba(0,0,0,0.5)\"},onMouseLeave:closeContextMenu,children:[/*#__PURE__*/_jsx(\"div\",{style:{padding:5,cursor:\"pointer\"},onClick:()=>{editMessage(contextMenu.index);closeContextMenu();},children:\"Bearbeiten\"}),/*#__PURE__*/_jsx(\"div\",{style:{padding:5,cursor:\"pointer\",color:\"red\"},onClick:()=>{deleteMessage(contextMenu.index);closeContextMenu();},children:\"L\\xF6schen\"})]})]});}","map":{"version":3,"names":["React","useEffect","useState","useRef","socket","jsxs","_jsxs","jsx","_jsx","ChatWindow","_ref","channel","messages","setMessages","contextMenu","setContextMenu","username","localStorage","getItem","scrollRef","emit","load","msgs","add","msg","prev","edit","_ref2","index","newText","copy","text","del","_ref3","filter","_","i","on","off","current","scrollTop","scrollHeight","sendMessage","input","document","getElementById","value","trim","user","handleKey","e","key","openContextMenu","preventDefault","x","clientX","y","clientY","closeContextMenu","editMessage","prompt","deleteMessage","window","confirm","style","flex","display","flexDirection","children","ref","overflowY","padding","color","map","m","onContextMenu","marginBottom","cursor","background","borderTop","id","onKeyDown","placeholder","concat","borderRadius","border","outline","onClick","marginLeft","position","top","left","zIndex","boxShadow","onMouseLeave"],"sources":["C:/Users/ericb/mini-discord/frontend/src/components/ChatWindow.jsx"],"sourcesContent":["import React, { useEffect, useState, useRef } from \"react\";\r\nimport { socket } from \"../socket\";\r\n\r\nexport default function ChatWindow({ channel }) {\r\n  const [messages, setMessages] = useState([]);\r\n  const [contextMenu, setContextMenu] = useState(null);\r\n  const username = localStorage.getItem(\"username\");\r\n  const scrollRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    socket.emit(\"requestMessages\", { channel });\r\n  }, [channel]);\r\n\r\n  useEffect(() => {\r\n    const load = (msgs) => setMessages(msgs);\r\n    const add = (msg) => {\r\n      if (msg.channel === channel) {\r\n        setMessages((prev) => [...prev, msg]);\r\n      }\r\n    };\r\n    const edit = ({ index, newText }) => {\r\n      setMessages((prev) => {\r\n        const copy = [...prev];\r\n        if (copy[index]) copy[index].text = newText;\r\n        return copy;\r\n      });\r\n    };\r\n    const del = ({ index }) => {\r\n      setMessages((prev) => prev.filter((_, i) => i !== index));\r\n    };\r\n\r\n    socket.on(\"loadMessages\", load);\r\n    socket.on(\"newMessage\", add);\r\n    socket.on(\"messageEdited\", edit);\r\n    socket.on(\"messageDeleted\", del);\r\n\r\n    return () => {\r\n      socket.off(\"loadMessages\", load);\r\n      socket.off(\"newMessage\", add);\r\n      socket.off(\"messageEdited\", edit);\r\n      socket.off(\"messageDeleted\", del);\r\n    };\r\n  }, [channel]);\r\n\r\n  useEffect(() => {\r\n    if (scrollRef.current) {\r\n      scrollRef.current.scrollTop = scrollRef.current.scrollHeight;\r\n    }\r\n  }, [messages]);\r\n\r\n  const sendMessage = () => {\r\n    const input = document.getElementById(\"chatInput\");\r\n    const text = input.value.trim();\r\n    if (!text) return;\r\n\r\n    socket.emit(\"sendMessage\", {\r\n      channel,\r\n      user: username,\r\n      text\r\n    });\r\n\r\n    input.value = \"\";\r\n  };\r\n\r\n  const handleKey = (e) => {\r\n    if (e.key === \"Enter\") sendMessage();\r\n  };\r\n\r\n  const openContextMenu = (e, index) => {\r\n    e.preventDefault();\r\n    setContextMenu({\r\n      x: e.clientX,\r\n      y: e.clientY,\r\n      index\r\n    });\r\n  };\r\n\r\n  const closeContextMenu = () => setContextMenu(null);\r\n\r\n  const editMessage = (index) => {\r\n    const newText = prompt(\"Neue Nachricht:\");\r\n    if (!newText) return;\r\n    socket.emit(\"editMessage\", { channel, index, newText });\r\n  };\r\n\r\n  const deleteMessage = (index) => {\r\n    if (!window.confirm(\"Nachricht löschen?\")) return;\r\n    socket.emit(\"deleteMessage\", { channel, index });\r\n  };\r\n\r\n  return (\r\n    <div style={{ flex: 1, display: \"flex\", flexDirection: \"column\" }}>\r\n      <div\r\n        ref={scrollRef}\r\n        style={{\r\n          flex: 1,\r\n          overflowY: \"auto\",\r\n          padding: 20,\r\n          color: \"white\"\r\n        }}\r\n      >\r\n        <h3># {channel}</h3>\r\n\r\n        {messages.map((m, i) => (\r\n          <div\r\n            key={i}\r\n            onContextMenu={(e) => openContextMenu(e, i)}\r\n            style={{ marginBottom: 10, cursor: \"context-menu\" }}\r\n          >\r\n            <b>{m.user}:</b> {m.text}\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n      <div\r\n        style={{\r\n          display: \"flex\",\r\n          padding: 10,\r\n          background: \"#232428\",\r\n          borderTop: \"1px solid #3a3b3f\"\r\n        }}\r\n      >\r\n        <input\r\n          id=\"chatInput\"\r\n          onKeyDown={handleKey}\r\n          placeholder={`Nachricht in #${channel}...`}\r\n          style={{\r\n            flex: 1,\r\n            padding: 10,\r\n            borderRadius: 4,\r\n            border: \"none\",\r\n            outline: \"none\"\r\n          }}\r\n        />\r\n        <button\r\n          onClick={sendMessage}\r\n          style={{\r\n            marginLeft: 10,\r\n            padding: \"10px 20px\",\r\n            background: \"#5865F2\",\r\n            border: \"none\",\r\n            borderRadius: 4,\r\n            color: \"white\",\r\n            cursor: \"pointer\"\r\n          }}\r\n        >\r\n          Senden\r\n        </button>\r\n      </div>\r\n\r\n      {contextMenu && (\r\n        <div\r\n          style={{\r\n            position: \"fixed\",\r\n            top: contextMenu.y,\r\n            left: contextMenu.x,\r\n            background: \"#2b2d31\",\r\n            padding: 10,\r\n            borderRadius: 4,\r\n            zIndex: 999,\r\n            boxShadow: \"0 0 10px rgba(0,0,0,0.5)\"\r\n          }}\r\n          onMouseLeave={closeContextMenu}\r\n        >\r\n          <div\r\n            style={{ padding: 5, cursor: \"pointer\" }}\r\n            onClick={() => {\r\n              editMessage(contextMenu.index);\r\n              closeContextMenu();\r\n            }}\r\n          >\r\n            Bearbeiten\r\n          </div>\r\n          <div\r\n            style={{ padding: 5, cursor: \"pointer\", color: \"red\" }}\r\n            onClick={() => {\r\n              deleteMessage(contextMenu.index);\r\n              closeContextMenu();\r\n            }}\r\n          >\r\n            Löschen\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import socket from\"../socket\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const API_BASE=\"http://localhost:3000\";function UserAvatar(_ref){let{user}=_ref;if(user.avatarType===\"generated\"){return/*#__PURE__*/_jsx(\"div\",{className:\"avatar\",style:{backgroundColor:user.avatarColor||\"#888\",color:\"#fff\",display:\"flex\",alignItems:\"center\",justifyContent:\"center\",fontWeight:\"bold\",fontSize:\"12px\",width:\"24px\",height:\"24px\",borderRadius:\"50%\",flexShrink:0},children:user.avatarLetter||\"?\"});}if(user.avatarType===\"upload\"&&user.avatarImage){return/*#__PURE__*/_jsx(\"img\",{src:user.avatarImage,alt:\"avatar\",className:\"avatar\",style:{width:\"24px\",height:\"24px\",borderRadius:\"50%\"}});}return/*#__PURE__*/_jsx(\"div\",{className:\"avatar\",style:{backgroundColor:\"#666\",width:\"24px\",height:\"24px\",borderRadius:\"50%\",display:\"flex\",alignItems:\"center\",justifyContent:\"center\",color:\"#fff\",fontSize:\"12px\"},children:\"?\"});}function UserList(){const[users,setUsers]=useState([]);const[online,setOnline]=useState([]);const[voiceState,setVoiceState]=useState({});const username=localStorage.getItem(\"username\");useEffect(()=>{async function loadUsers(){try{const res=await fetch(\"\".concat(API_BASE,\"/api/users/all-public\"));const data=await res.json();if(data.ok){setUsers(data.users);}}catch(err){console.error(\"Fehler beim Laden der User:\",err);}}loadUsers();function handleOnline(_ref2){let{userId}=_ref2;setOnline(prev=>[...new Set([...prev,userId])]);}function handleOffline(_ref3){let{userId}=_ref3;setOnline(prev=>prev.filter(id=>id!==userId));}function handleVoiceUpdate(state){setVoiceState(state||{});}socket.on(\"userOnline\",handleOnline);socket.on(\"userOffline\",handleOffline);socket.on(\"voiceChannelUpdate\",handleVoiceUpdate);return()=>{socket.off(\"userOnline\",handleOnline);socket.off(\"userOffline\",handleOffline);socket.off(\"voiceChannelUpdate\",handleVoiceUpdate);};},[]);function getVoiceChannel(userId){for(const[channel,members]of Object.entries(voiceState)){if(members.some(m=>m.id===userId)){return channel;}}return null;}return/*#__PURE__*/_jsxs(\"div\",{className:\"user-list\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Online\"}),users.filter(u=>online.includes(u.id)).map(u=>{const channel=getVoiceChannel(u.id);const isSelf=u.username===username;return/*#__PURE__*/_jsxs(\"div\",{className:\"user-online\"+(isSelf?\" user-self\":\"\"),children:[/*#__PURE__*/_jsx(UserAvatar,{user:u}),/*#__PURE__*/_jsx(\"span\",{children:u.username}),channel&&/*#__PURE__*/_jsxs(\"span\",{className:\"user-voice-status\",children:[\"in \",channel]})]},u.id);})]});}export default UserList;","map":{"version":3,"names":["React","useEffect","useState","socket","jsx","_jsx","jsxs","_jsxs","API_BASE","UserAvatar","_ref","user","avatarType","className","style","backgroundColor","avatarColor","color","display","alignItems","justifyContent","fontWeight","fontSize","width","height","borderRadius","flexShrink","children","avatarLetter","avatarImage","src","alt","UserList","users","setUsers","online","setOnline","voiceState","setVoiceState","username","localStorage","getItem","loadUsers","res","fetch","concat","data","json","ok","err","console","error","handleOnline","_ref2","userId","prev","Set","handleOffline","_ref3","filter","id","handleVoiceUpdate","state","on","off","getVoiceChannel","channel","members","Object","entries","some","m","u","includes","map","isSelf"],"sources":["C:/Users/ericb/mini-discord/frontend/src/components/UserList.jsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport socket from \"../socket\";\r\n\r\nconst API_BASE = \"http://localhost:3000\";\r\n\r\nfunction UserAvatar({ user }) {\r\n  if (user.avatarType === \"generated\") {\r\n    return (\r\n      <div\r\n        className=\"avatar\"\r\n        style={{\r\n          backgroundColor: user.avatarColor || \"#888\",\r\n          color: \"#fff\",\r\n          display: \"flex\",\r\n          alignItems: \"center\",\r\n          justifyContent: \"center\",\r\n          fontWeight: \"bold\",\r\n          fontSize: \"12px\",\r\n          width: \"24px\",\r\n          height: \"24px\",\r\n          borderRadius: \"50%\",\r\n          flexShrink: 0\r\n        }}\r\n      >\r\n        {user.avatarLetter || \"?\"}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (user.avatarType === \"upload\" && user.avatarImage) {\r\n    return (\r\n      <img\r\n        src={user.avatarImage}\r\n        alt=\"avatar\"\r\n        className=\"avatar\"\r\n        style={{ width: \"24px\", height: \"24px\", borderRadius: \"50%\" }}\r\n      />\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div\r\n      className=\"avatar\"\r\n      style={{\r\n        backgroundColor: \"#666\",\r\n        width: \"24px\",\r\n        height: \"24px\",\r\n        borderRadius: \"50%\",\r\n        display: \"flex\",\r\n        alignItems: \"center\",\r\n        justifyContent: \"center\",\r\n        color: \"#fff\",\r\n        fontSize: \"12px\"\r\n      }}\r\n    >\r\n      ?\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction UserList() {\r\n  const [users, setUsers] = useState([]);\r\n  const [online, setOnline] = useState([]);\r\n  const [voiceState, setVoiceState] = useState({});\r\n  const username = localStorage.getItem(\"username\");\r\n\r\n  useEffect(() => {\r\n    async function loadUsers() {\r\n      try {\r\n        const res = await fetch(`${API_BASE}/api/users/all-public`);\r\n        const data = await res.json();\r\n        if (data.ok) {\r\n          setUsers(data.users);\r\n        }\r\n      } catch (err) {\r\n        console.error(\"Fehler beim Laden der User:\", err);\r\n      }\r\n    }\r\n\r\n    loadUsers();\r\n\r\n    function handleOnline({ userId }) {\r\n      setOnline((prev) => [...new Set([...prev, userId])]);\r\n    }\r\n\r\n    function handleOffline({ userId }) {\r\n      setOnline((prev) => prev.filter((id) => id !== userId));\r\n    }\r\n\r\n    function handleVoiceUpdate(state) {\r\n      setVoiceState(state || {});\r\n    }\r\n\r\n    socket.on(\"userOnline\", handleOnline);\r\n    socket.on(\"userOffline\", handleOffline);\r\n    socket.on(\"voiceChannelUpdate\", handleVoiceUpdate);\r\n\r\n    return () => {\r\n      socket.off(\"userOnline\", handleOnline);\r\n      socket.off(\"userOffline\", handleOffline);\r\n      socket.off(\"voiceChannelUpdate\", handleVoiceUpdate);\r\n    };\r\n  }, []);\r\n\r\n  function getVoiceChannel(userId) {\r\n    for (const [channel, members] of Object.entries(voiceState)) {\r\n      if (members.some((m) => m.id === userId)) {\r\n        return channel;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div className=\"user-list\">\r\n      <h3>Online</h3>\r\n      {users\r\n        .filter((u) => online.includes(u.id))\r\n        .map((u) => {\r\n          const channel = getVoiceChannel(u.id);\r\n          const isSelf = u.username === username;\r\n          return (\r\n            <div\r\n              key={u.id}\r\n              className={\"user-online\" + (isSelf ? \" user-self\" : \"\")}\r\n            >\r\n              <UserAvatar user={u} />\r\n              <span>{u.username}</span>\r\n              {channel && (\r\n                <span className=\"user-voice-status\">in {channel}</span>\r\n              )}\r\n            </div>\r\n          );\r\n        })}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default UserList;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
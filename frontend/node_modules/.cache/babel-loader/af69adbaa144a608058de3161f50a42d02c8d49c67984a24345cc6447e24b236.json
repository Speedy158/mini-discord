{"ast":null,"code":"import { socket } from \"./socket\";\nlet localStream = null;\nlet peerConnection = null;\nconst iceConfig = {\n  iceServers: [{\n    urls: \"stun:stun.l.google.com:19302\"\n  }]\n};\nexport async function startCall(setRemoteAudio) {\n  localStream = await navigator.mediaDevices.getUserMedia({\n    audio: true\n  });\n  peerConnection = new RTCPeerConnection(iceConfig);\n  localStream.getTracks().forEach(track => {\n    peerConnection.addTrack(track, localStream);\n  });\n  peerConnection.onicecandidate = event => {\n    if (event.candidate) {\n      socket.emit(\"webrtc-ice-candidate\", event.candidate);\n    }\n  };\n  peerConnection.ontrack = event => {\n    setRemoteAudio(event.streams[0]);\n  };\n  const offer = await peerConnection.createOffer();\n  await peerConnection.setLocalDescription(offer);\n  socket.emit(\"webrtc-offer\", offer);\n  return localStream;\n}\nexport async function handleOffer(offer, setRemoteAudio) {\n  peerConnection = new RTCPeerConnection(iceConfig);\n  localStream = await navigator.mediaDevices.getUserMedia({\n    audio: true\n  });\n  localStream.getTracks().forEach(track => {\n    peerConnection.addTrack(track, localStream);\n  });\n  peerConnection.onicecandidate = event => {\n    if (event.candidate) {\n      socket.emit(\"webrtc-ice-candidate\", event.candidate);\n    }\n  };\n  peerConnection.ontrack = event => {\n    setRemoteAudio(event.streams[0]);\n  };\n  await peerConnection.setRemoteDescription(offer);\n  const answer = await peerConnection.createAnswer();\n  await peerConnection.setLocalDescription(answer);\n  socket.emit(\"webrtc-answer\", answer);\n  return localStream;\n}\nexport async function handleAnswer(answer) {\n  await peerConnection.setRemoteDescription(answer);\n}\nexport function handleIceCandidate(candidate) {\n  peerConnection.addIceCandidate(candidate);\n}\nexport function muteLocalAudio() {\n  if (!localStream) return;\n  localStream.getAudioTracks().forEach(t => t.enabled = false);\n}\nexport function unmuteLocalAudio() {\n  if (!localStream) return;\n  localStream.getAudioTracks().forEach(t => t.enabled = true);\n}\nexport function isLocalMuted() {\n  if (!localStream) return false;\n  const track = localStream.getAudioTracks()[0];\n  return track ? !track.enabled : false;\n}\nexport function endCall() {\n  if (peerConnection) peerConnection.close();\n  if (localStream) {\n    localStream.getTracks().forEach(t => t.stop());\n  }\n  peerConnection = null;\n  localStream = null;\n}","map":{"version":3,"names":["socket","localStream","peerConnection","iceConfig","iceServers","urls","startCall","setRemoteAudio","navigator","mediaDevices","getUserMedia","audio","RTCPeerConnection","getTracks","forEach","track","addTrack","onicecandidate","event","candidate","emit","ontrack","streams","offer","createOffer","setLocalDescription","handleOffer","setRemoteDescription","answer","createAnswer","handleAnswer","handleIceCandidate","addIceCandidate","muteLocalAudio","getAudioTracks","t","enabled","unmuteLocalAudio","isLocalMuted","endCall","close","stop"],"sources":["C:/Users/ericb/mini-discord/frontend/src/webrtc.js"],"sourcesContent":["import { socket } from \"./socket\";\r\n\r\nlet localStream = null;\r\nlet peerConnection = null;\r\n\r\nconst iceConfig = {\r\n  iceServers: [{ urls: \"stun:stun.l.google.com:19302\" }],\r\n};\r\n\r\nexport async function startCall(setRemoteAudio) {\r\n  localStream = await navigator.mediaDevices.getUserMedia({ audio: true });\r\n\r\n  peerConnection = new RTCPeerConnection(iceConfig);\r\n\r\n  localStream.getTracks().forEach((track) => {\r\n    peerConnection.addTrack(track, localStream);\r\n  });\r\n\r\n  peerConnection.onicecandidate = (event) => {\r\n    if (event.candidate) {\r\n      socket.emit(\"webrtc-ice-candidate\", event.candidate);\r\n    }\r\n  };\r\n\r\n  peerConnection.ontrack = (event) => {\r\n    setRemoteAudio(event.streams[0]);\r\n  };\r\n\r\n  const offer = await peerConnection.createOffer();\r\n  await peerConnection.setLocalDescription(offer);\r\n\r\n  socket.emit(\"webrtc-offer\", offer);\r\n\r\n  return localStream;\r\n}\r\n\r\nexport async function handleOffer(offer, setRemoteAudio) {\r\n  peerConnection = new RTCPeerConnection(iceConfig);\r\n\r\n  localStream = await navigator.mediaDevices.getUserMedia({ audio: true });\r\n  localStream.getTracks().forEach((track) => {\r\n    peerConnection.addTrack(track, localStream);\r\n  });\r\n\r\n  peerConnection.onicecandidate = (event) => {\r\n    if (event.candidate) {\r\n      socket.emit(\"webrtc-ice-candidate\", event.candidate);\r\n    }\r\n  };\r\n\r\n  peerConnection.ontrack = (event) => {\r\n    setRemoteAudio(event.streams[0]);\r\n  };\r\n\r\n  await peerConnection.setRemoteDescription(offer);\r\n\r\n  const answer = await peerConnection.createAnswer();\r\n  await peerConnection.setLocalDescription(answer);\r\n\r\n  socket.emit(\"webrtc-answer\", answer);\r\n\r\n  return localStream;\r\n}\r\n\r\nexport async function handleAnswer(answer) {\r\n  await peerConnection.setRemoteDescription(answer);\r\n}\r\n\r\nexport function handleIceCandidate(candidate) {\r\n  peerConnection.addIceCandidate(candidate);\r\n}\r\n\r\nexport function muteLocalAudio() {\r\n  if (!localStream) return;\r\n  localStream.getAudioTracks().forEach((t) => (t.enabled = false));\r\n}\r\n\r\nexport function unmuteLocalAudio() {\r\n  if (!localStream) return;\r\n  localStream.getAudioTracks().forEach((t) => (t.enabled = true));\r\n}\r\n\r\nexport function isLocalMuted() {\r\n  if (!localStream) return false;\r\n  const track = localStream.getAudioTracks()[0];\r\n  return track ? !track.enabled : false;\r\n}\r\n\r\nexport function endCall() {\r\n  if (peerConnection) peerConnection.close();\r\n  if (localStream) {\r\n    localStream.getTracks().forEach((t) => t.stop());\r\n  }\r\n  peerConnection = null;\r\n  localStream = null;\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}